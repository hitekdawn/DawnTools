local RXbDI2={[1]="\65\99\101\65\100\100\111\110\45\51\46\48",[2]="\68\97\119\110\84\111\111\108\115",[3]="\68\97\119\110\77\97\105\108\76\111\103",[4]="\65\99\101\69\118\101\110\116\45\51\46\48",[5]="\65\99\101\72\111\111\107\45\51\46\48",[6]="\65\99\101\67\111\110\115\111\108\101\45\51\46\48",[7]="\83\116\100\85\105",[8]="\77\65\73\76\95\83\85\67\67\69\83\83",[9]="\79\110\69\118\101\110\116",[10]="\77\65\73\76\95\73\78\66\79\88\95\85\80\68\65\84\69",[11]="\79\110\69\118\101\110\116",[12]=nil,[13]="",[14]="\112\108\97\121\101\114",[15]="\45",[16]="\37\89\45\37\109\45\37\100",[17]="\85\78\75\78\79\87\78\45\83\69\78\68\69\82",[18]=1,[19]=true,[20]=10,[21]="\115\101\110\116",[22]="\114\101\99\101\105\118\101\100",[23]=1400,[24]=700,[25]="\68\97\119\110\32\77\97\105\108\32\76\111\103\32\86\105\101\119\101\114",[26]="\67\69\78\84\69\82",[27]="\67\69\78\84\69\82",[28]=0,[29]="\79\110\68\114\97\103\83\116\111\112",[30]="\66\79\84\84\79\77\82\73\71\72\84",[31]=850,[32]=250,[33]="\79\110\77\111\117\115\101\68\111\119\110",[34]=32,[35]="\67\69\78\84\69\82",[36]="\82\73\71\72\84",[37]=16,[38]=5,[39]="\76\69\70\84",[40]=128,[41]="\67\108\101\97\114\32\76\111\103",[42]="\67\69\78\84\69\82",[43]="\79\110\67\108\105\99\107",[44]="\84\104\105\115\32\67\104\97\114\97\99\116\101\114",[45]="\65\108\108\32\77\97\105\108",[46]="\67\108\101\97\114\32\76\111\103",[47]="\83\101\108\101\99\116\32\108\111\103\32\116\111\32\99\108\101\97\114\46\32\84\104\101\115\101\32\97\99\116\105\111\110\115\32\67\65\78\78\79\84\32\66\69\32\82\69\86\69\82\83\69\68\46\32\66\111\116\104\32\115\101\110\116\32\97\110\100\32\114\101\99\101\105\118\101\100\32\109\97\105\108\32\119\105\108\108\32\98\101\32\100\101\108\101\116\101\100\46",[48]="\112\108\97\121\101\114",[49]="\45",[50]=400,[51]=30,[52]="\83\101\97\114\99\104",[53]="\73\110\116\101\114\102\97\99\101\92\67\111\109\109\111\110\92\85\73\45\83\101\97\114\99\104\98\111\120\45\73\99\111\110",[54]=80,[55]="\83\101\97\114\99\104",[56]=40,[57]="\76\69\70\84",[58]=420,[59]="\76\69\70\84",[60]="\79\110\69\110\116\101\114\80\114\101\115\115\101\100",[61]="\79\110\67\108\105\99\107",[62]="\65\108\108\32\99\104\97\114\97\99\116\101\114\115",[63]="\83\104\111\119\32\97\108\108\32\109\97\105\108\32\114\101\99\101\105\118\101\100\32\98\121\32\97\110\121\32\99\104\97\114\97\99\116\101\114\32\111\110\32\116\104\105\115\32\97\99\99\111\117\110\116\46",[64]="\116\111\111\108\116\105\112",[65]="\82\73\71\72\84",[66]="\79\110\108\121\32\115\104\111\119\32\116\111\100\97\121",[67]="\79\110\108\121\32\115\104\111\119\32\109\97\105\108\32\116\104\97\116\32\119\97\115\32\114\101\99\101\105\118\101\100\32\111\114\32\115\101\110\116\32\116\111\100\97\121\46",[68]="\116\111\111\108\116\105\112",[69]="\82\73\71\72\84",[70]="\68\97\116\101\32\83\101\110\116",[71]=225,[72]="\67\69\78\84\69\82",[73]="\100\97\116\101",[74]="\115\116\114\105\110\103",[75]="\97\115\99",[76]="\68\97\116\101\32\79\112\101\110\101\100",[77]="\67\69\78\84\69\82",[78]="\100\97\116\101\79\112\101\110\101\100",[79]="\115\116\114\105\110\103",[80]="\97\115\99",[81]="\83\101\110\100\101\114",[82]=150,[83]="\67\69\78\84\69\82",[84]="\115\111\117\114\99\101",[85]="\115\116\114\105\110\103",[86]="\82\101\99\105\112\105\101\110\116",[87]="\67\69\78\84\69\82",[88]="\100\101\115\116\105\110\97\116\105\111\110",[89]="\115\116\114\105\110\103",[90]="\71\111\108\100",[91]="\76\69\70\84",[92]="\103\111\108\100",[93]="\109\111\110\101\121",[94]="\83\117\98\106\101\99\116",[95]="\76\69\70\84",[96]="\115\117\98\106\101\99\116",[97]="\115\116\114\105\110\103",[98]="\66\111\100\121",[99]="\76\69\70\84",[100]="\98\111\100\121",[101]="\115\116\114\105\110\103",[102]=false,[103]="\83\101\110\116\47\82\101\99\101\105\118\101\100",[104]="\67\69\78\84\69\82",[105]="\115\101\110\116",[106]="\83\101\110\116",[107]="\82\101\99\101\105\118\101\100",[108]=18,[109]=29,[110]=110,[111]=50,[112]="\78\111\32\114\101\115\117\108\116\115\32\102\111\117\110\100\46",[113]="\67\69\78\84\69\82",[114]="\100\97\116\101",[115]="\100\97\116\101",[116]="\78\111\32\114\101\115\117\108\116\115\32\102\111\117\110\100\46",[117]="\67\117\114\114\101\110\116\32\114\101\115\117\108\116\115\58\32",[118]="\91\77\97\105\108\32\76\111\103\93\32\67\108\101\97\110\101\100\32\117\112\32\37\105\32\109\97\105\108\32\108\111\103\115\32\111\108\100\101\114\32\116\104\97\110\32\37\105\32\100\97\121\115",[119]="\88\70\85\53\75\52\55\48\82\32\49\53\32\52\87\51\53\48\77\51\46\32\75\82\51\68\49\55\32\55\48\32\88\70\85\53\75\52\55\48\82\33"}local u989MIQjqO=LibStub(RXbDI2[1]):GetAddon(RXbDI2[2])local mRpSlWULvqGSvwIrVZ8f=u989MIQjqO:NewModule(RXbDI2[3],RXbDI2[4],RXbDI2[5],RXbDI2[6])local wJysyXBefgiY1DR4Lj0=LibStub(RXbDI2[7])function mRpSlWULvqGSvwIrVZ8f:OnEnable()self.configDB=u989MIQjqO.db.char;self.db=u989MIQjqO.db.global.maillog;self:RegisterEvent(RXbDI2[8],RXbDI2[9])self:RegisterEvent(RXbDI2[10],RXbDI2[11])self.CleanUp()end;function mRpSlWULvqGSvwIrVZ8f:OpenPanel()if(self.maillogWindow==RXbDI2[12])then self:DrawWindow()self:DrawSearchPane()self:DrawSearchResultsTable()self:SearchMail(RXbDI2[13])else self.maillogWindow:Show()self:SearchMail(RXbDI2[13])end end;function mRpSlWULvqGSvwIrVZ8f:IsVisible()return self.maillogWindow and self.maillogWindow:IsVisible()end;function mRpSlWULvqGSvwIrVZ8f:Hide()if self.maillogWindow then self.maillogWindow:Hide()end end;function mRpSlWULvqGSvwIrVZ8f:SearchMail(o)local hK4GMm2G53Mcn9LFAMBK3=self.maillogWindow;local Lzf0Xtl6ouOU1ptNBgazF=o:lower()local FwA0Ita6gQ59gAt5=u989MIQjqO.db.global.maillog;local jvCiEO2aBJFJh1Z={}local xVUOLDFACQInHu2nS,VOw0saT=UnitFullName(RXbDI2[14])local a8dJK=xVUOLDFACQInHu2nS..RXbDI2[15]..VOw0saT;local ZRHK6vlMdopUjk=hK4GMm2G53Mcn9LFAMBK3.allCharactersToggle:GetChecked()local TpO1EOTCnmXHCy1XEv=hK4GMm2G53Mcn9LFAMBK3.todayToggle:GetChecked()local Lz0bFQBaRsO=date(RXbDI2[16])for JtY,VppM5601IIJB in pairs(FwA0Ita6gQ59gAt5)do if(VppM5601IIJB.source==RXbDI2[12])then VppM5601IIJB.source=RXbDI2[17]end;if(VppM5601IIJB.dateOpened==RXbDI2[12])then VppM5601IIJB.dateOpened=VppM5601IIJB.date end;if(ZRHK6vlMdopUjk or(VppM5601IIJB.source and VppM5601IIJB.source:lower():find(a8dJK:lower(),RXbDI2[18],RXbDI2[19])or VppM5601IIJB.destination and VppM5601IIJB.destination:lower():find(a8dJK:lower(),RXbDI2[18],RXbDI2[19]))~=RXbDI2[12])and(VppM5601IIJB.date and(not TpO1EOTCnmXHCy1XEv or string.sub(VppM5601IIJB.date,RXbDI2[18],RXbDI2[20])==Lz0bFQBaRsO))and(VppM5601IIJB.subject and VppM5601IIJB.subject:lower():find(Lzf0Xtl6ouOU1ptNBgazF,RXbDI2[18],RXbDI2[19])or VppM5601IIJB.body and VppM5601IIJB.body:lower():find(Lzf0Xtl6ouOU1ptNBgazF,RXbDI2[18],RXbDI2[19])or VppM5601IIJB.gold and tostring(floor(VppM5601IIJB.gold/COPPER_PER_GOLD)):find(Lzf0Xtl6ouOU1ptNBgazF,RXbDI2[18],RXbDI2[19])or VppM5601IIJB.source and VppM5601IIJB.source:lower():find(Lzf0Xtl6ouOU1ptNBgazF,RXbDI2[18],RXbDI2[19])or VppM5601IIJB.destination and VppM5601IIJB.destination:lower():find(Lzf0Xtl6ouOU1ptNBgazF,RXbDI2[18],RXbDI2[19])or VppM5601IIJB.date and VppM5601IIJB.date:lower():find(Lzf0Xtl6ouOU1ptNBgazF,RXbDI2[18],RXbDI2[19])or Lzf0Xtl6ouOU1ptNBgazF==RXbDI2[21]and VppM5601IIJB.sent or Lzf0Xtl6ouOU1ptNBgazF==RXbDI2[22]and not VppM5601IIJB.sent)then table.insert(jvCiEO2aBJFJh1Z,VppM5601IIJB)end end;mRpSlWULvqGSvwIrVZ8f:ApplyDefaultSort(jvCiEO2aBJFJh1Z)self.currentView=jvCiEO2aBJFJh1Z;self.maillogWindow.searchResults:SetData(self.currentView,RXbDI2[19])mRpSlWULvqGSvwIrVZ8f:UpdateStateText()mRpSlWULvqGSvwIrVZ8f:UpdateResultsText()end;function mRpSlWULvqGSvwIrVZ8f:DrawWindow()local K7DT1sQIJ=wJysyXBefgiY1DR4Lj0:Window(UIParent,RXbDI2[23],RXbDI2[24],RXbDI2[25])K7DT1sQIJ:SetPoint(RXbDI2[26],UIParent,RXbDI2[27],RXbDI2[28],RXbDI2[28])K7DT1sQIJ:SetScript(RXbDI2[29],function(W5uhAslTYwOC43)W5uhAslTYwOC43:StopMovingOrSizing()end)wJysyXBefgiY1DR4Lj0:MakeResizable(K7DT1sQIJ,RXbDI2[30])K7DT1sQIJ:SetResizeBounds(RXbDI2[31],RXbDI2[32])K7DT1sQIJ:SetFrameLevel(u989MIQjqO:GetNextFrameLevel())K7DT1sQIJ:SetScript(RXbDI2[33],function(bkswiZmOUwKO)bkswiZmOUwKO:SetFrameLevel(u989MIQjqO:GetNextFrameLevel())end)local sonGhGTWxBIg=wJysyXBefgiY1DR4Lj0:Frame(K7DT1sQIJ,RXbDI2[34],RXbDI2[34])local MaQtQO=wJysyXBefgiY1DR4Lj0:Texture(sonGhGTWxBIg,RXbDI2[34],RXbDI2[34],u989MIQjqO.LogoPath)wJysyXBefgiY1DR4Lj0:GlueTop(MaQtQO,sonGhGTWxBIg,RXbDI2[28],RXbDI2[28],RXbDI2[35])wJysyXBefgiY1DR4Lj0:GlueBottom(sonGhGTWxBIg,K7DT1sQIJ,-RXbDI2[20],RXbDI2[20],RXbDI2[36])K7DT1sQIJ.resultsLabel=wJysyXBefgiY1DR4Lj0:Label(K7DT1sQIJ,RXbDI2[12],RXbDI2[37])wJysyXBefgiY1DR4Lj0:GlueBottom(K7DT1sQIJ.resultsLabel,K7DT1sQIJ,RXbDI2[20],RXbDI2[38],RXbDI2[39])local i=wJysyXBefgiY1DR4Lj0:Button(K7DT1sQIJ,RXbDI2[40],RXbDI2[37],RXbDI2[41])wJysyXBefgiY1DR4Lj0:GlueBottom(i,K7DT1sQIJ,RXbDI2[28],RXbDI2[20],RXbDI2[42])i:SetScript(RXbDI2[43],function()mRpSlWULvqGSvwIrVZ8f:DrawClearWarningWindow()end)self.maillogWindow=K7DT1sQIJ end;function mRpSlWULvqGSvwIrVZ8f:DrawClearWarningWindow()local H1V2puT9V={character={text=RXbDI2[44],onClick=function(Fk)mRpSlWULvqGSvwIrVZ8f:ClearMailForCharacter()Fk.window:Hide()end},all={text=RXbDI2[45],onClick=function(UL9ooQ6dNxo4If1)mRpSlWULvqGSvwIrVZ8f:ClearAllMail()UL9ooQ6dNxo4If1.window:Hide()end}}wJysyXBefgiY1DR4Lj0:Confirm(RXbDI2[46],RXbDI2[47],H1V2puT9V,RXbDI2[18])end;function mRpSlWULvqGSvwIrVZ8f:ClearMailForCharacter()local QsdTdqO,tjJJUrWlQ1LuJ=UnitFullName(RXbDI2[48])local T=QsdTdqO..RXbDI2[49]..tjJJUrWlQ1LuJ;for u_AvEaaWu2O,Mk12Ea5_ in pairs(u989MIQjqO.db.global.maillog)do if Mk12Ea5_.source==T or Mk12Ea5_.destination==T then u989MIQjqO.db.global.maillog[u_AvEaaWu2O]=RXbDI2[12]end end;if(self.maillogWindow)then mRpSlWULvqGSvwIrVZ8f:SearchMail(self.maillogWindow.searchBox:GetText())end end;function mRpSlWULvqGSvwIrVZ8f:ClearAllMail()for eyM8,wdpcHVwcr in pairs(u989MIQjqO.db.global.maillog)do u989MIQjqO.db.global.maillog[eyM8]=RXbDI2[12]end;if(self.maillogWindow)then mRpSlWULvqGSvwIrVZ8f:SearchMail(self.maillogWindow.searchBox:GetText())end end;function mRpSlWULvqGSvwIrVZ8f:DrawSearchPane()local QBszuB6Uxs1Sc3=self.maillogWindow;local oN33PT=wJysyXBefgiY1DR4Lj0:Autocomplete(QBszuB6Uxs1Sc3,RXbDI2[50],RXbDI2[51],RXbDI2[13],RXbDI2[12],RXbDI2[12],RXbDI2[12])wJysyXBefgiY1DR4Lj0:ApplyPlaceholder(oN33PT,RXbDI2[52],RXbDI2[53])oN33PT:SetFontSize(RXbDI2[37])local vIoQ1iktn1uPlQm=wJysyXBefgiY1DR4Lj0:Button(QBszuB6Uxs1Sc3,RXbDI2[54],RXbDI2[51],RXbDI2[55])wJysyXBefgiY1DR4Lj0:GlueTop(oN33PT,QBszuB6Uxs1Sc3,RXbDI2[20],-RXbDI2[56],RXbDI2[57])wJysyXBefgiY1DR4Lj0:GlueTop(vIoQ1iktn1uPlQm,QBszuB6Uxs1Sc3,RXbDI2[58],-RXbDI2[56],RXbDI2[59])oN33PT:SetScript(RXbDI2[60],function()mRpSlWULvqGSvwIrVZ8f:SearchMail(oN33PT:GetText())end)vIoQ1iktn1uPlQm:SetScript(RXbDI2[61],function()mRpSlWULvqGSvwIrVZ8f:SearchMail(oN33PT:GetText())end)local hlP5z8dpqvQ12=wJysyXBefgiY1DR4Lj0:Checkbox(QBszuB6Uxs1Sc3,RXbDI2[62])wJysyXBefgiY1DR4Lj0:GlueRight(hlP5z8dpqvQ12,vIoQ1iktn1uPlQm,RXbDI2[20],RXbDI2[28])hlP5z8dpqvQ12.OnValueChanged=function(MjBGe,F05Hhd)mRpSlWULvqGSvwIrVZ8f:SearchMail(oN33PT:GetText())end;local El4WnLnNe4bgb68qEt8a=wJysyXBefgiY1DR4Lj0:FrameTooltip(hlP5z8dpqvQ12,RXbDI2[63],RXbDI2[64],RXbDI2[65],RXbDI2[19])local N3ZbYu4Ks58Y64brq41=wJysyXBefgiY1DR4Lj0:Checkbox(QBszuB6Uxs1Sc3,RXbDI2[66])wJysyXBefgiY1DR4Lj0:GlueRight(N3ZbYu4Ks58Y64brq41,hlP5z8dpqvQ12,RXbDI2[20],RXbDI2[28])N3ZbYu4Ks58Y64brq41.OnValueChanged=function(MnlNhY,Jzee)mRpSlWULvqGSvwIrVZ8f:SearchMail(oN33PT:GetText())end;local qZ6UQASb7IqUdt8Ys=wJysyXBefgiY1DR4Lj0:FrameTooltip(N3ZbYu4Ks58Y64brq41,RXbDI2[67],RXbDI2[68],RXbDI2[69],RXbDI2[19])QBszuB6Uxs1Sc3.allCharactersToggle=hlP5z8dpqvQ12;QBszuB6Uxs1Sc3.todayToggle=N3ZbYu4Ks58Y64brq41;QBszuB6Uxs1Sc3.searchBox=oN33PT;QBszuB6Uxs1Sc3.searchButton=vIoQ1iktn1uPlQm end;function mRpSlWULvqGSvwIrVZ8f:DrawSearchResultsTable()local s=self.maillogWindow;local function oXjtIt8X2a(krwopgnVhlF7,gqFw,xju)if gqFw then GameTooltip:SetOwner(krwopgnVhlF7)GameTooltip:SetText(xju)else GameTooltip:Hide()end end;local RdUXotiJlT4ULX1uAhSh={{name=RXbDI2[70],width=RXbDI2[71],align=RXbDI2[72],index=RXbDI2[73],format=RXbDI2[74],defaultSort=RXbDI2[75]},{name=RXbDI2[76],width=RXbDI2[71],align=RXbDI2[77],index=RXbDI2[78],format=RXbDI2[79],defaultSort=RXbDI2[80]},{name=RXbDI2[81],width=RXbDI2[82],align=RXbDI2[83],index=RXbDI2[84],format=RXbDI2[85]},{name=RXbDI2[86],width=RXbDI2[82],align=RXbDI2[87],index=RXbDI2[88],format=RXbDI2[89]},{name=RXbDI2[90],width=RXbDI2[82],align=RXbDI2[91],index=RXbDI2[92],format=RXbDI2[93]},{name=RXbDI2[94],width=RXbDI2[82],align=RXbDI2[95],index=RXbDI2[96],format=RXbDI2[97]},{name=RXbDI2[98],width=RXbDI2[82],align=RXbDI2[99],index=RXbDI2[100],format=RXbDI2[101],events={OnEnter=function(VP4w4Fl59RLUgmDb,URpewXP_YeYMK7P,KtbjkoklV7kN,OIy8omiBcPCWDXm,vNS3CVwGW7udk0m,L)if OIy8omiBcPCWDXm.body then oXjtIt8X2a(URpewXP_YeYMK7P,RXbDI2[19],OIy8omiBcPCWDXm.body)end;return RXbDI2[19]end,OnLeave=function(EDHSHkdtLLOt0cZkO_iZD,b_VrY8IEVIS1RIw3Wg)oXjtIt8X2a(b_VrY8IEVIS1RIw3Wg,RXbDI2[102])return RXbDI2[19]end}},{name=RXbDI2[103],width=RXbDI2[82],align=RXbDI2[104],index=RXbDI2[105],sortable=RXbDI2[102],format=function(wuRf3sMol_ea,VCJhR2umJRFcsc66WGw1N,SVQjXf2G1C1h)if(wuRf3sMol_ea)then return RXbDI2[106]else return RXbDI2[107]end end}}s.searchResults=wJysyXBefgiY1DR4Lj0:ScrollTable(s,RdUXotiJlT4ULX1uAhSh,RXbDI2[108],RXbDI2[109])s.searchResults:EnableSelection(RXbDI2[19])wJysyXBefgiY1DR4Lj0:GlueAcross(s.searchResults,s,RXbDI2[20],-RXbDI2[110],-RXbDI2[20],RXbDI2[111])s.stateLabel=wJysyXBefgiY1DR4Lj0:Label(s.searchResults,RXbDI2[112])wJysyXBefgiY1DR4Lj0:GlueTop(s.stateLabel,s.searchResults,RXbDI2[28],-RXbDI2[56],RXbDI2[113])end;function mRpSlWULvqGSvwIrVZ8f:ApplyDefaultSort(z7dKAisvS)if(self.maillogWindow.searchResults.head.columns)then local ohLOQ7aubwIsO4W0ciG=RXbDI2[102]for YC,qTdrHTEvS7ryA6iQiJO0 in pairs(self.maillogWindow.searchResults.head.columns)do if(qTdrHTEvS7ryA6iQiJO0.arrow:IsVisible())then ohLOQ7aubwIsO4W0ciG=RXbDI2[19]end end;if(not ohLOQ7aubwIsO4W0ciG)then return table.sort(z7dKAisvS,function(BF,EmdijSwQ9)return BF[RXbDI2[114]]>EmdijSwQ9[RXbDI2[115]]end)end end;return z7dKAisvS end;function mRpSlWULvqGSvwIrVZ8f:UpdateStateText()if(#self.currentView>RXbDI2[28])then self.maillogWindow.stateLabel:Hide()else self.maillogWindow.stateLabel:SetText(RXbDI2[116])end end;function mRpSlWULvqGSvwIrVZ8f:UpdateResultsText()if(#self.currentView>RXbDI2[28])then self.maillogWindow.resultsLabel:SetText(RXbDI2[117]..tostring(#self.currentView))self.maillogWindow.resultsLabel:Show()else self.maillogWindow.resultsLabel:Hide()end end;function mRpSlWULvqGSvwIrVZ8f:OnEvent(L)if(self.maillogWindow)then C_Timer.After(RXbDI2[18],function()mRpSlWULvqGSvwIrVZ8f:SearchMail(self.maillogWindow.searchBox:GetText())end)end end;function mRpSlWULvqGSvwIrVZ8f:CleanUp()local ECxjVRB6PTPWvvex=u989MIQjqO.db.global.maillog;local Gbt0_KkkjMM3tzT=RXbDI2[28]local pIP07X3wdXrMIJWrqg=u989MIQjqO.db.global.logCleanupDays;for e4LsuSQjAYY,lYQKzEBljPIeVxrNlvZv in pairs(ECxjVRB6PTPWvvex)do local Nb8I3l6Peo3bssL5=u989MIQjqO.helperFunctions:IsOlderThanDays(lYQKzEBljPIeVxrNlvZv.date,pIP07X3wdXrMIJWrqg)if Nb8I3l6Peo3bssL5 ==RXbDI2[19]then Gbt0_KkkjMM3tzT=Gbt0_KkkjMM3tzT+RXbDI2[18]ECxjVRB6PTPWvvex[e4LsuSQjAYY]=RXbDI2[12]end end;if Gbt0_KkkjMM3tzT>RXbDI2[28]then u989MIQjqO:Printf(RXbDI2[118],Gbt0_KkkjMM3tzT,pIP07X3wdXrMIJWrqg)end end