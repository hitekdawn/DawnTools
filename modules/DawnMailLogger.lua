local xYHaf={[1]="\65\99\101\65\100\100\111\110\45\51\46\48",[2]="\68\97\119\110\84\111\111\108\115",[3]="\68\97\119\110\77\97\105\108\76\111\103\103\101\114",[4]="\65\99\101\69\118\101\110\116\45\51\46\48",[5]="\65\99\101\84\105\109\101\114\45\51\46\48",[6]=30,[7]=1000,[8]=10,[9]=1,[10]=true,[11]=0,[12]=65521,[13]=65536,[14]="\37\48\56\120",[15]="\68\97\119\110\84\111\111\108\115",[16]="",[17]=false,[18]="\58",[19]="\109\105\115\115\105\110\103",[20]="\118\97\108\105\100",[21]="\116\97\109\112\101\114\101\100",[22]="\77\65\73\76\95\83\85\67\67\69\83\83",[23]="\79\110\69\118\101\110\116",[24]="\80\76\65\89\69\82\95\77\79\78\69\89",[25]="\79\110\69\118\101\110\116",[26]="\77\65\73\76\95\70\65\73\76\69\68",[27]="\79\110\69\118\101\110\116",[28]="\77\97\105\108\32\76\111\103\103\101\114\124\114\58\32\124\99\70\70\70\70\48\48\48\48\73\110\118\97\108\105\100\32\109\97\105\108\32\100\97\116\97\44\32\110\111\116\32\108\111\103\103\105\110\103\124\114",[29]="\77\97\105\108\32\76\111\103\103\101\114\124\114\58\32\124\99\70\70\70\70\65\65\48\48",[30]="\124\114",[31]="\81\117\101\117\101\32\111\118\101\114\102\108\111\119\32\40\62",[32]="\32\101\110\116\114\105\101\115\41\44\32\102\111\114\99\105\110\103\32\99\108\101\97\110\117\112",[33]="\81\117\101\117\101\32\115\116\105\108\108\32\102\117\108\108\32\97\102\116\101\114\32\99\111\109\112\97\99\116\105\111\110\44\32\100\114\111\112\112\105\110\103\32\111\108\100\101\115\116\32\101\110\116\114\121",[34]="\79\110\84\105\109\101\111\117\116",[35]=nil,[36]=100000,[37]="\115\101\110\100",[38]="\114\101\99\101\105\118\101",[39]="\77\97\105\108\32\102\97\105\108\101\100\58\32\37\115\32\45\62\32\37\115\32\40\37\46\48\102\103\41",[40]="\85\78\75\78\79\87\78",[41]="\85\78\75\78\79\87\78",[42]="\84\105\109\101\111\117\116\58\32\78\111\32\101\118\101\110\116\32\102\111\114\32\37\115\32\109\97\105\108\32\37\115\32\45\62\32\37\115\32\40\37\46\48\102\103\41\32\97\102\116\101\114\32\37\100\115",[43]="\85\78\75\78\79\87\78",[44]="\85\78\75\78\79\87\78",[45]="\77\65\73\76\95\83\85\67\67\69\83\83",[46]="\80\76\65\89\69\82\95\77\79\78\69\89",[47]="\77\65\73\76\95\70\65\73\76\69\68",[48]="\83\101\110\100\77\97\105\108",[49]="\112\108\97\121\101\114",[50]="\45",[51]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[52]="\115\101\110\100",[53]="\84\97\107\101\73\110\98\111\120\77\111\110\101\121",[54]=3,[55]="\45",[56]="\112\108\97\121\101\114",[57]="\45",[58]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[59]=31,[60]=24,[61]=60,[62]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[63]="\112\108\97\121\101\114",[64]="\45",[65]="\114\101\99\101\105\118\101",[66]="\65\117\116\111\76\111\111\116\77\97\105\108\73\116\101\109",[67]="\45",[68]="\112\108\97\121\101\114",[69]="\45",[70]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[71]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[72]="\112\108\97\121\101\114",[73]="\45",[74]="\114\101\99\101\105\118\101",[75]="\80\114\111\99\101\115\115\78\101\120\116\73\116\101\109",[76]=0.3,[77]="\88\70\85\53\75\52\55\48\82\32\49\53\32\52\87\51\53\48\77\51\46\32\75\82\51\68\49\55\32\55\48\32\88\70\85\53\75\52\55\48\82\33"}local zaCITxvX6WYEs=LibStub(xYHaf[1]):GetAddon(xYHaf[2])local zQx5W0P8g8So=zaCITxvX6WYEs:NewModule(xYHaf[3],xYHaf[4],xYHaf[5])local ZuVu4vzxaBVzeDBwj=xYHaf[6]local RGncFr2LYPKBkIhjqDO=xYHaf[7]local CAIBegN_P=xYHaf[8]zQx5W0P8g8So.pendingQueue={}zQx5W0P8g8So.queueHead=xYHaf[9]zQx5W0P8g8So.timeoutTimers={}zQx5W0P8g8So.enabled=xYHaf[10]zQx5W0P8g8So.eventCount=xYHaf[11]zQx5W0P8g8So.lastKnownMoney=xYHaf[11]function zQx5W0P8g8So:Adler32(fMRT)local mE6cSk=xYHaf[9]local roMuh_Cs1mEYZt9Q=xYHaf[11]local WbS3oOGFtD=xYHaf[12]for i=xYHaf[9],#fMRT do mE6cSk=(mE6cSk+string.byte(fMRT,i))%WbS3oOGFtD;roMuh_Cs1mEYZt9Q=(roMuh_Cs1mEYZt9Q+mE6cSk)%WbS3oOGFtD end;local JVSWP=(roMuh_Cs1mEYZt9Q*xYHaf[13])+mE6cSk;return string.format(xYHaf[14],JVSWP)end;function zQx5W0P8g8So:GenerateMailChecksum(ipTjTVA93)local sXBfWCsoOi={xYHaf[15],ipTjTVA93.source or xYHaf[16],ipTjTVA93.destination or xYHaf[16],tostring(ipTjTVA93.gold or xYHaf[16]),ipTjTVA93.subject or xYHaf[16],ipTjTVA93.body or xYHaf[16],tostring(ipTjTVA93.sent or xYHaf[16]),ipTjTVA93.date or xYHaf[16]}if ipTjTVA93.sent==xYHaf[17]and ipTjTVA93.dateOpened then table.insert(sXBfWCsoOi,ipTjTVA93.dateOpened)end;local JQDuMOt=table.concat(sXBfWCsoOi,xYHaf[18])return self:Adler32(JQDuMOt)end;function zQx5W0P8g8So:ValidateMailChecksum(RWG)if not RWG.id then return xYHaf[19]end;local WyuU=self:GenerateMailChecksum(RWG)if RWG.id==WyuU then return xYHaf[20]else return xYHaf[21]end end;function zQx5W0P8g8So:OnEnable()self.db=zaCITxvX6WYEs.db.global.maillog;self:RegisterEvent(xYHaf[22],xYHaf[23])self:RegisterEvent(xYHaf[24],xYHaf[25])self:RegisterEvent(xYHaf[26],xYHaf[27])self.lastKnownMoney=GetMoney()end;function zQx5W0P8g8So:LogMailEntry(WuLhUhg2nMCvhyVZk1m4)if not WuLhUhg2nMCvhyVZk1m4.source or not WuLhUhg2nMCvhyVZk1m4.destination or not WuLhUhg2nMCvhyVZk1m4.gold then zaCITxvX6WYEs:Print(zaCITxvX6WYEs.ColorString..xYHaf[28])return xYHaf[17]end;WuLhUhg2nMCvhyVZk1m4.id=self:GenerateMailChecksum(WuLhUhg2nMCvhyVZk1m4)self.db[#self.db+xYHaf[9]]=WuLhUhg2nMCvhyVZk1m4;return xYHaf[10]end;function zQx5W0P8g8So:LogWarning(iWnakvOx)zaCITxvX6WYEs:Print(zaCITxvX6WYEs.ColorString..xYHaf[29]..iWnakvOx..xYHaf[30])end;function zQx5W0P8g8So:EnqueueMail(J4bvgfQLZ,JHHlCbojWk0qO)if#self.pendingQueue>=RGncFr2LYPKBkIhjqDO then self:LogWarning(xYHaf[31]..RGncFr2LYPKBkIhjqDO..xYHaf[32])self:CompactQueue()if#self.pendingQueue>=RGncFr2LYPKBkIhjqDO then self:LogWarning(xYHaf[33])table.remove(self.pendingQueue,self.queueHead)end end;local WrZgPP64=#self.pendingQueue+xYHaf[9]local uDgZ9GqqYMY5={mailData=J4bvgfQLZ,timestamp=GetServerTime(),type=JHHlCbojWk0qO,queueIndex=WrZgPP64,goldBeforeSend=GetMoney()}self.pendingQueue[WrZgPP64]=uDgZ9GqqYMY5;self.timeoutTimers[WrZgPP64]=self:ScheduleTimer(xYHaf[34],ZuVu4vzxaBVzeDBwj,WrZgPP64)return WrZgPP64 end;function zQx5W0P8g8So:ProcessQueueHead()if self.queueHead>#self.pendingQueue then return xYHaf[17]end;local o3sEOF7tVj14=self.pendingQueue[self.queueHead]self:LogMailEntry(o3sEOF7tVj14.mailData)if self.timeoutTimers[o3sEOF7tVj14.queueIndex]then self:CancelTimer(self.timeoutTimers[o3sEOF7tVj14.queueIndex])self.timeoutTimers[o3sEOF7tVj14.queueIndex]=xYHaf[35]end;self.queueHead=self.queueHead+xYHaf[9]self.eventCount=self.eventCount+xYHaf[9]if self.eventCount>=CAIBegN_P then self:CompactQueue()self.eventCount=xYHaf[11]end;return xYHaf[10]end;function zQx5W0P8g8So:OnMailSuccess()if self:ProcessQueueHead()then self.lastKnownMoney=GetMoney()end end;function zQx5W0P8g8So:OnPlayerMoney()if self.queueHead>#self.pendingQueue then self.lastKnownMoney=GetMoney()return end;local ks2wXz0CvxpIDlfQ16pxN=GetMoney()local UuUhyJB2Kjx0v9mNdH=self.lastKnownMoney-ks2wXz0CvxpIDlfQ16pxN;local CLLW370T=self.pendingQueue[self.queueHead]local zvIxolMWnImZFe3gX=xYHaf[36]local MxNdts6fM0Gs8Xsx=CLLW370T.mailData.gold;if CLLW370T.type==xYHaf[37]then MxNdts6fM0Gs8Xsx=CLLW370T.mailData.gold elseif CLLW370T.type==xYHaf[38]then MxNdts6fM0Gs8Xsx=-CLLW370T.mailData.gold end;if math.abs(UuUhyJB2Kjx0v9mNdH-MxNdts6fM0Gs8Xsx)<=zvIxolMWnImZFe3gX then if self:ProcessQueueHead()then self.lastKnownMoney=ks2wXz0CvxpIDlfQ16pxN end else self.lastKnownMoney=ks2wXz0CvxpIDlfQ16pxN end end;function zQx5W0P8g8So:OnMailFailed()if self.queueHead>#self.pendingQueue then return end;local WJe_Igtulzr6L1SleMSp=self.pendingQueue[self.queueHead]local FqTU=WJe_Igtulzr6L1SleMSp.mailData.gold/COPPER_PER_GOLD;self:LogWarning(string.format(xYHaf[39],WJe_Igtulzr6L1SleMSp.mailData.source or xYHaf[40],WJe_Igtulzr6L1SleMSp.mailData.destination or xYHaf[41],FqTU))if self.timeoutTimers[WJe_Igtulzr6L1SleMSp.queueIndex]then self:CancelTimer(self.timeoutTimers[WJe_Igtulzr6L1SleMSp.queueIndex])self.timeoutTimers[WJe_Igtulzr6L1SleMSp.queueIndex]=xYHaf[35]end;self.queueHead=self.queueHead+xYHaf[9]self.eventCount=self.eventCount+xYHaf[9]if self.eventCount>=CAIBegN_P then self:CompactQueue()self.eventCount=xYHaf[11]end end;function zQx5W0P8g8So:OnTimeout(SNQlW)self.timeoutTimers[SNQlW]=xYHaf[35]if SNQlW<self.queueHead then return end;if SNQlW==self.queueHead then local AMUn7OSKhSsRjk=self.pendingQueue[SNQlW]if AMUn7OSKhSsRjk then local ox=GetMoney()local J3l=AMUn7OSKhSsRjk.goldBeforeSend-AMUn7OSKhSsRjk.mailData.gold-xYHaf[6]local u=xYHaf[36]if math.abs(ox-J3l)<=u then self:LogMailEntry(AMUn7OSKhSsRjk.mailData)if self.timeoutTimers[AMUn7OSKhSsRjk.queueIndex]then self:CancelTimer(self.timeoutTimers[AMUn7OSKhSsRjk.queueIndex])self.timeoutTimers[AMUn7OSKhSsRjk.queueIndex]=xYHaf[35]end else local sEi2pgL4BnKBkCX07w5I=AMUn7OSKhSsRjk.mailData.gold/COPPER_PER_GOLD;self:LogWarning(string.format(xYHaf[42],AMUn7OSKhSsRjk.type,AMUn7OSKhSsRjk.mailData.source or xYHaf[43],AMUn7OSKhSsRjk.mailData.destination or xYHaf[44],sEi2pgL4BnKBkCX07w5I,ZuVu4vzxaBVzeDBwj))end end;self.queueHead=self.queueHead+xYHaf[9]self:CompactQueue()else end end;function zQx5W0P8g8So:CompactQueue()if self.queueHead<=xYHaf[9]then return end;local HgWXDlXJvGagFJl={}for i=self.queueHead,#self.pendingQueue do table.insert(HgWXDlXJvGagFJl,self.pendingQueue[i])end;self.pendingQueue=HgWXDlXJvGagFJl;self.queueHead=xYHaf[9]end;function zQx5W0P8g8So:OnEvent(jtpTaeKPFLcyszhRFJerr,...)if jtpTaeKPFLcyszhRFJerr==xYHaf[45]then self:OnMailSuccess()elseif jtpTaeKPFLcyszhRFJerr==xYHaf[46]then self:OnPlayerMoney()elseif jtpTaeKPFLcyszhRFJerr==xYHaf[47]then self:OnMailFailed()end end;hooksecurefunc(xYHaf[48],function(M5QR1If5BG,ixZv72cjcn3lrcsI3y,_)if not zQx5W0P8g8So.enabled then return end;local wSd_lkszz2=GetSendMailMoney()if wSd_lkszz2 <=xYHaf[11]then return end;local NPIR_AoLduIPZL8KPr,AOS=UnitFullName(xYHaf[49])local hPV7YcvwZJaOQ74x7Ke1m={source=NPIR_AoLduIPZL8KPr..xYHaf[50]..AOS,destination=M5QR1If5BG,gold=wSd_lkszz2,subject=ixZv72cjcn3lrcsI3y,body=_,sent=xYHaf[10],date=date(xYHaf[51],GetServerTime())}zQx5W0P8g8So:EnqueueMail(hPV7YcvwZJaOQ74x7Ke1m,xYHaf[52])end)hooksecurefunc(xYHaf[53],function(Oze9m8VkPZR2_u8b)if not zQx5W0P8g8So.enabled then return end;local K5Fewi7VoIYXSrzGm,KAd46oj5PcG2w,x4Epz4GlGC40nXtiO,qZJS5DquwY,qYtCnVNAvQDT8vr4R=select(xYHaf[54],GetInboxHeaderInfo(Oze9m8VkPZR2_u8b))if x4Epz4GlGC40nXtiO<=xYHaf[11]then return end;local hkw=GetInboxText(Oze9m8VkPZR2_u8b)if K5Fewi7VoIYXSrzGm and not K5Fewi7VoIYXSrzGm:find(xYHaf[55])then local Vz2Rqw5_xoiprd7mg,RA2ywwasIf2K5It1m=UnitFullName(xYHaf[56])K5Fewi7VoIYXSrzGm=K5Fewi7VoIYXSrzGm..xYHaf[57]..RA2ywwasIf2K5It1m end;local XAUA=date(xYHaf[58],GetServerTime()- (xYHaf[59]-qYtCnVNAvQDT8vr4R)*xYHaf[60]*xYHaf[61]*xYHaf[61])local rsw6KW38BTYr=date(xYHaf[62],GetServerTime())local MJiNZY,vzuW=UnitFullName(xYHaf[63])local IMnN7En_SPuT={source=K5Fewi7VoIYXSrzGm,destination=MJiNZY..xYHaf[64]..vzuW,gold=x4Epz4GlGC40nXtiO,subject=KAd46oj5PcG2w,body=hkw,sent=xYHaf[17],date=XAUA,dateOpened=rsw6KW38BTYr}zQx5W0P8g8So:EnqueueMail(IMnN7En_SPuT,xYHaf[65])end)hooksecurefunc(xYHaf[66],function(WOKq03311H7DxgrrBg)if not zQx5W0P8g8So.enabled then return end;local LTaXsPcVauTHIU,eZCb1AqJiAF_Zl_bxU,xCz_dtAPmDwGbyH4F2ed,qMFXViMgdzkO,PE64=select(xYHaf[54],GetInboxHeaderInfo(WOKq03311H7DxgrrBg))if xCz_dtAPmDwGbyH4F2ed<=xYHaf[11]then return end;local cIn7pAlXoc=GetInboxText(WOKq03311H7DxgrrBg)if LTaXsPcVauTHIU and not LTaXsPcVauTHIU:find(xYHaf[67])then local SsvvF3M8yJJronS5kEkc5,xF60918PeOZcIxzxc7PCJ=UnitFullName(xYHaf[68])LTaXsPcVauTHIU=LTaXsPcVauTHIU..xYHaf[69]..xF60918PeOZcIxzxc7PCJ end;local VN8CQaozHlY_=date(xYHaf[70],GetServerTime()- (xYHaf[59]-PE64)*xYHaf[60]*xYHaf[61]*xYHaf[61])local acvJSovsJsP=date(xYHaf[71],GetServerTime())local wIWY7gWOla3twyi,rO=UnitFullName(xYHaf[72])local Zs1S={source=LTaXsPcVauTHIU,destination=wIWY7gWOla3twyi..xYHaf[73]..rO,gold=xCz_dtAPmDwGbyH4F2ed,subject=eZCb1AqJiAF_Zl_bxU,body=cIn7pAlXoc,sent=xYHaf[17],date=VN8CQaozHlY_,dateOpened=acvJSovsJsP}zQx5W0P8g8So:EnqueueMail(Zs1S,xYHaf[74])end)if OpenAllMail then hooksecurefunc(OpenAllMail,xYHaf[75],function(fnyMEBeIwRF3q)fnyMEBeIwRF3q.timeUntilNextRetrieval=xYHaf[76]end)end