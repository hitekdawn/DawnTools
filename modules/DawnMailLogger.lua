local i4xjgpXiv={[1]="\65\99\101\65\100\100\111\110\45\51\46\48",[2]="\68\97\119\110\84\111\111\108\115",[3]="\68\97\119\110\77\97\105\108\76\111\103\103\101\114",[4]="\65\99\101\69\118\101\110\116\45\51\46\48",[5]="\65\99\101\84\105\109\101\114\45\51\46\48",[6]=30,[7]=1000,[8]=10,[9]=1,[10]=true,[11]=0,[12]=65521,[13]=65536,[14]="\37\48\56\120",[15]="\68\97\119\110\84\111\111\108\115",[16]="",[17]=false,[18]="\58",[19]="\109\105\115\115\105\110\103",[20]="\118\97\108\105\100",[21]="\116\97\109\112\101\114\101\100",[22]="\77\65\73\76\95\83\85\67\67\69\83\83",[23]="\79\110\69\118\101\110\116",[24]="\80\76\65\89\69\82\95\77\79\78\69\89",[25]="\79\110\69\118\101\110\116",[26]="\77\65\73\76\95\70\65\73\76\69\68",[27]="\79\110\69\118\101\110\116",[28]="\77\97\105\108\32\76\111\103\103\101\114\124\114\58\32\124\99\70\70\70\70\48\48\48\48\73\110\118\97\108\105\100\32\109\97\105\108\32\100\97\116\97\44\32\110\111\116\32\108\111\103\103\105\110\103\124\114",[29]="\77\97\105\108\32\76\111\103\103\101\114\124\114\58\32\124\99\70\70\70\70\65\65\48\48",[30]="\124\114",[31]="\81\117\101\117\101\32\111\118\101\114\102\108\111\119\32\40\62",[32]="\32\101\110\116\114\105\101\115\41\44\32\102\111\114\99\105\110\103\32\99\108\101\97\110\117\112",[33]="\81\117\101\117\101\32\115\116\105\108\108\32\102\117\108\108\32\97\102\116\101\114\32\99\111\109\112\97\99\116\105\111\110\44\32\100\114\111\112\112\105\110\103\32\111\108\100\101\115\116\32\101\110\116\114\121",[34]="\79\110\84\105\109\101\111\117\116",[35]=nil,[36]=100000,[37]="\115\101\110\100",[38]="\114\101\99\101\105\118\101",[39]="\77\97\105\108\32\102\97\105\108\101\100\58\32\37\115\32\45\62\32\37\115\32\40\37\46\48\102\103\41",[40]="\85\78\75\78\79\87\78",[41]="\85\78\75\78\79\87\78",[42]="\84\105\109\101\111\117\116\58\32\78\111\32\101\118\101\110\116\32\102\111\114\32\37\115\32\109\97\105\108\32\37\115\32\45\62\32\37\115\32\40\37\46\48\102\103\41\32\97\102\116\101\114\32\37\100\115",[43]="\85\78\75\78\79\87\78",[44]="\85\78\75\78\79\87\78",[45]="\77\65\73\76\95\83\85\67\67\69\83\83",[46]="\80\76\65\89\69\82\95\77\79\78\69\89",[47]="\77\65\73\76\95\70\65\73\76\69\68",[48]="\83\101\110\100\77\97\105\108",[49]="\112\108\97\121\101\114",[50]="\45",[51]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[52]="\115\101\110\100",[53]="\84\97\107\101\73\110\98\111\120\77\111\110\101\121",[54]=3,[55]="\45",[56]="\112\108\97\121\101\114",[57]="\45",[58]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[59]=31,[60]=24,[61]=60,[62]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[63]="\112\108\97\121\101\114",[64]="\45",[65]="\114\101\99\101\105\118\101",[66]="\65\117\116\111\76\111\111\116\77\97\105\108\73\116\101\109",[67]="\45",[68]="\112\108\97\121\101\114",[69]="\45",[70]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[71]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[72]="\112\108\97\121\101\114",[73]="\45",[74]="\114\101\99\101\105\118\101",[75]="\80\114\111\99\101\115\115\78\101\120\116\73\116\101\109",[76]=0.3,[77]="\88\70\85\53\75\52\55\48\82\32\49\53\32\52\87\51\53\48\77\51\46\32\75\82\51\68\49\55\32\55\48\32\88\70\85\53\75\52\55\48\82\33"}local xSO4h=LibStub(i4xjgpXiv[1]):GetAddon(i4xjgpXiv[2])local wPAexwKvVKBdWX=xSO4h:NewModule(i4xjgpXiv[3],i4xjgpXiv[4],i4xjgpXiv[5])local KFLLpwfDtQd=i4xjgpXiv[6]local Ht0Rz2BB6u68L4Ty8P=i4xjgpXiv[7]local nHwrggLXAdn=i4xjgpXiv[8]wPAexwKvVKBdWX.pendingQueue={}wPAexwKvVKBdWX.queueHead=i4xjgpXiv[9]wPAexwKvVKBdWX.timeoutTimers={}wPAexwKvVKBdWX.enabled=i4xjgpXiv[10]wPAexwKvVKBdWX.eventCount=i4xjgpXiv[11]wPAexwKvVKBdWX.lastKnownMoney=i4xjgpXiv[11]function wPAexwKvVKBdWX:Adler32(fMvEF22KNj)local k=i4xjgpXiv[9]local GUEvWXNluCcI=i4xjgpXiv[11]local O_z5TsB8TOI=i4xjgpXiv[12]for i=i4xjgpXiv[9],#fMvEF22KNj do k=(k+string.byte(fMvEF22KNj,i))%O_z5TsB8TOI;GUEvWXNluCcI=(GUEvWXNluCcI+k)%O_z5TsB8TOI end;local YvhkV2RM1b=(GUEvWXNluCcI*i4xjgpXiv[13])+k;return string.format(i4xjgpXiv[14],YvhkV2RM1b)end;function wPAexwKvVKBdWX:GenerateMailChecksum(qbRw)local _zS6={i4xjgpXiv[15],qbRw.source or i4xjgpXiv[16],qbRw.destination or i4xjgpXiv[16],tostring(qbRw.gold or i4xjgpXiv[16]),qbRw.subject or i4xjgpXiv[16],qbRw.body or i4xjgpXiv[16],tostring(qbRw.sent or i4xjgpXiv[16]),qbRw.date or i4xjgpXiv[16]}if qbRw.sent==i4xjgpXiv[17]and qbRw.dateOpened then table.insert(_zS6,qbRw.dateOpened)end;local xW0f=table.concat(_zS6,i4xjgpXiv[18])return self:Adler32(xW0f)end;function wPAexwKvVKBdWX:ValidateMailChecksum(AI_OrfJIjw4Bvh3JPZHFp)if not AI_OrfJIjw4Bvh3JPZHFp.id then return i4xjgpXiv[19]end;local ZH=self:GenerateMailChecksum(AI_OrfJIjw4Bvh3JPZHFp)if AI_OrfJIjw4Bvh3JPZHFp.id==ZH then return i4xjgpXiv[20]else return i4xjgpXiv[21]end end;function wPAexwKvVKBdWX:OnEnable()self.db=xSO4h.db.global.maillog;self:RegisterEvent(i4xjgpXiv[22],i4xjgpXiv[23])self:RegisterEvent(i4xjgpXiv[24],i4xjgpXiv[25])self:RegisterEvent(i4xjgpXiv[26],i4xjgpXiv[27])self.lastKnownMoney=GetMoney()end;function wPAexwKvVKBdWX:LogMailEntry(ByF2cJNJ)if not ByF2cJNJ.source or not ByF2cJNJ.destination or not ByF2cJNJ.gold then xSO4h:Print(xSO4h.ColorString..i4xjgpXiv[28])return i4xjgpXiv[17]end;ByF2cJNJ.id=self:GenerateMailChecksum(ByF2cJNJ)self.db[#self.db+i4xjgpXiv[9]]=ByF2cJNJ;return i4xjgpXiv[10]end;function wPAexwKvVKBdWX:LogWarning(_fkx4mRXSJoY5dCbx4ON)xSO4h:Print(xSO4h.ColorString..i4xjgpXiv[29].._fkx4mRXSJoY5dCbx4ON..i4xjgpXiv[30])end;function wPAexwKvVKBdWX:EnqueueMail(WzK7uzTikrH,iuk)if#self.pendingQueue>=Ht0Rz2BB6u68L4Ty8P then self:LogWarning(i4xjgpXiv[31]..Ht0Rz2BB6u68L4Ty8P..i4xjgpXiv[32])self:CompactQueue()if#self.pendingQueue>=Ht0Rz2BB6u68L4Ty8P then self:LogWarning(i4xjgpXiv[33])table.remove(self.pendingQueue,self.queueHead)end end;local am3rQAdyi_iv49=#self.pendingQueue+i4xjgpXiv[9]local a55SAed1Qe6Rgc1ytc5ZM={mailData=WzK7uzTikrH,timestamp=GetServerTime(),type=iuk,queueIndex=am3rQAdyi_iv49}self.pendingQueue[am3rQAdyi_iv49]=a55SAed1Qe6Rgc1ytc5ZM;self.timeoutTimers[am3rQAdyi_iv49]=self:ScheduleTimer(i4xjgpXiv[34],KFLLpwfDtQd,am3rQAdyi_iv49)return am3rQAdyi_iv49 end;function wPAexwKvVKBdWX:ProcessQueueHead()if self.queueHead>#self.pendingQueue then return i4xjgpXiv[17]end;local xZ=self.pendingQueue[self.queueHead]self:LogMailEntry(xZ.mailData)if self.timeoutTimers[xZ.queueIndex]then self:CancelTimer(self.timeoutTimers[xZ.queueIndex])self.timeoutTimers[xZ.queueIndex]=i4xjgpXiv[35]end;self.queueHead=self.queueHead+i4xjgpXiv[9]self.eventCount=self.eventCount+i4xjgpXiv[9]if self.eventCount>=nHwrggLXAdn then self:CompactQueue()self.eventCount=i4xjgpXiv[11]end;return i4xjgpXiv[10]end;function wPAexwKvVKBdWX:OnMailSuccess()if self:ProcessQueueHead()then self.lastKnownMoney=GetMoney()end end;function wPAexwKvVKBdWX:OnPlayerMoney()if self.queueHead>#self.pendingQueue then self.lastKnownMoney=GetMoney()return end;local OlWFmkymDPWi=GetMoney()local SWI3POEy7nI=self.lastKnownMoney-OlWFmkymDPWi;local VVR7M7K2gFBW=self.pendingQueue[self.queueHead]local THVdK=i4xjgpXiv[36]local ddpHTmvXOc_7XQK5=VVR7M7K2gFBW.mailData.gold;if VVR7M7K2gFBW.type==i4xjgpXiv[37]then ddpHTmvXOc_7XQK5=VVR7M7K2gFBW.mailData.gold elseif VVR7M7K2gFBW.type==i4xjgpXiv[38]then ddpHTmvXOc_7XQK5=-VVR7M7K2gFBW.mailData.gold end;if math.abs(SWI3POEy7nI-ddpHTmvXOc_7XQK5)<=THVdK then if self:ProcessQueueHead()then self.lastKnownMoney=OlWFmkymDPWi end else self.lastKnownMoney=OlWFmkymDPWi end end;function wPAexwKvVKBdWX:OnMailFailed()if self.queueHead>#self.pendingQueue then return end;local WpPcLf7fL17d40PaHeh=self.pendingQueue[self.queueHead]local qaND40YBn11z4AQ1=WpPcLf7fL17d40PaHeh.mailData.gold/COPPER_PER_GOLD;self:LogWarning(string.format(i4xjgpXiv[39],WpPcLf7fL17d40PaHeh.mailData.source or i4xjgpXiv[40],WpPcLf7fL17d40PaHeh.mailData.destination or i4xjgpXiv[41],qaND40YBn11z4AQ1))if self.timeoutTimers[WpPcLf7fL17d40PaHeh.queueIndex]then self:CancelTimer(self.timeoutTimers[WpPcLf7fL17d40PaHeh.queueIndex])self.timeoutTimers[WpPcLf7fL17d40PaHeh.queueIndex]=i4xjgpXiv[35]end;self.queueHead=self.queueHead+i4xjgpXiv[9]self.eventCount=self.eventCount+i4xjgpXiv[9]if self.eventCount>=nHwrggLXAdn then self:CompactQueue()self.eventCount=i4xjgpXiv[11]end end;function wPAexwKvVKBdWX:OnTimeout(vWdhLraB)self.timeoutTimers[vWdhLraB]=i4xjgpXiv[35]if vWdhLraB<self.queueHead then return end;if vWdhLraB==self.queueHead then local lf7z=self.pendingQueue[vWdhLraB]if lf7z then local V4KoWgfpbpNPwpm8RY7O=lf7z.mailData.gold/COPPER_PER_GOLD;self:LogWarning(string.format(i4xjgpXiv[42],lf7z.type,lf7z.mailData.source or i4xjgpXiv[43],lf7z.mailData.destination or i4xjgpXiv[44],V4KoWgfpbpNPwpm8RY7O,KFLLpwfDtQd))end;self.queueHead=self.queueHead+i4xjgpXiv[9]self:CompactQueue()else end end;function wPAexwKvVKBdWX:CompactQueue()if self.queueHead<=i4xjgpXiv[9]then return end;local grLLm={}for i=self.queueHead,#self.pendingQueue do table.insert(grLLm,self.pendingQueue[i])end;self.pendingQueue=grLLm;self.queueHead=i4xjgpXiv[9]end;function wPAexwKvVKBdWX:OnEvent(M3SezNqXis7LJEUbyV,...)if M3SezNqXis7LJEUbyV==i4xjgpXiv[45]then self:OnMailSuccess()elseif M3SezNqXis7LJEUbyV==i4xjgpXiv[46]then self:OnPlayerMoney()elseif M3SezNqXis7LJEUbyV==i4xjgpXiv[47]then self:OnMailFailed()end end;hooksecurefunc(i4xjgpXiv[48],function(tWitySw_VblI0,tQarDjGwI,CR3BBQqX)if not wPAexwKvVKBdWX.enabled then return end;local rcQ=GetSendMailMoney()if rcQ<=i4xjgpXiv[11]then return end;local o927G7XVAOO,i853n8HBgBtUP=UnitFullName(i4xjgpXiv[49])local Z3Ordj_MqFmTkHmg6V1={source=o927G7XVAOO..i4xjgpXiv[50]..i853n8HBgBtUP,destination=tWitySw_VblI0,gold=rcQ,subject=tQarDjGwI,body=CR3BBQqX,sent=i4xjgpXiv[10],date=date(i4xjgpXiv[51],GetServerTime())}wPAexwKvVKBdWX:EnqueueMail(Z3Ordj_MqFmTkHmg6V1,i4xjgpXiv[52])end)hooksecurefunc(i4xjgpXiv[53],function(rxogB3d1aq3z2ccsdRZj)if not wPAexwKvVKBdWX.enabled then return end;local Sg8L4I,LY6PqvEwB,V4eKtndCgaXFeAfP,l6EOtHWrDLeWXwhDqZ,AgZ3BOO3GucQ3HO=select(i4xjgpXiv[54],GetInboxHeaderInfo(rxogB3d1aq3z2ccsdRZj))if V4eKtndCgaXFeAfP<=i4xjgpXiv[11]then return end;local n9bw7M=GetInboxText(rxogB3d1aq3z2ccsdRZj)if Sg8L4I and not Sg8L4I:find(i4xjgpXiv[55])then local r8awJrYRd2v,N5e59OGQaIbVziti1wc8=UnitFullName(i4xjgpXiv[56])Sg8L4I=Sg8L4I..i4xjgpXiv[57]..N5e59OGQaIbVziti1wc8 end;local ihUeYykWHhPwfNmxC0=date(i4xjgpXiv[58],GetServerTime()- (i4xjgpXiv[59]-AgZ3BOO3GucQ3HO)*i4xjgpXiv[60]*i4xjgpXiv[61]*i4xjgpXiv[61])local s8E0cw=date(i4xjgpXiv[62],GetServerTime())local LWlvnfuqC7y22,N18B6T69MyEtS1Px_j2l=UnitFullName(i4xjgpXiv[63])local ggviBqU={source=Sg8L4I,destination=LWlvnfuqC7y22 ..i4xjgpXiv[64]..N18B6T69MyEtS1Px_j2l,gold=V4eKtndCgaXFeAfP,subject=LY6PqvEwB,body=n9bw7M,sent=i4xjgpXiv[17],date=ihUeYykWHhPwfNmxC0,dateOpened=s8E0cw}wPAexwKvVKBdWX:EnqueueMail(ggviBqU,i4xjgpXiv[65])end)hooksecurefunc(i4xjgpXiv[66],function(V7CH6FNNCKN1Q1V6ptBa)if not wPAexwKvVKBdWX.enabled then return end;local BaSZisgCqrd0i,sKWLZBchGlQm,I9_WzjFxU,j5mG2OnQlZXyFM,SUtc3l8_K2pkUX=select(i4xjgpXiv[54],GetInboxHeaderInfo(V7CH6FNNCKN1Q1V6ptBa))if I9_WzjFxU<=i4xjgpXiv[11]then return end;local JIsKCW0=GetInboxText(V7CH6FNNCKN1Q1V6ptBa)if BaSZisgCqrd0i and not BaSZisgCqrd0i:find(i4xjgpXiv[67])then local GOE,LmuAxx6J=UnitFullName(i4xjgpXiv[68])BaSZisgCqrd0i=BaSZisgCqrd0i..i4xjgpXiv[69]..LmuAxx6J end;local tW_I=date(i4xjgpXiv[70],GetServerTime()- (i4xjgpXiv[59]-SUtc3l8_K2pkUX)*i4xjgpXiv[60]*i4xjgpXiv[61]*i4xjgpXiv[61])local yljqy=date(i4xjgpXiv[71],GetServerTime())local JNO8fBPr,tWuvf1iaSHsx=UnitFullName(i4xjgpXiv[72])local HV7wM3s1U={source=BaSZisgCqrd0i,destination=JNO8fBPr..i4xjgpXiv[73]..tWuvf1iaSHsx,gold=I9_WzjFxU,subject=sKWLZBchGlQm,body=JIsKCW0,sent=i4xjgpXiv[17],date=tW_I,dateOpened=yljqy}wPAexwKvVKBdWX:EnqueueMail(HV7wM3s1U,i4xjgpXiv[74])end)if OpenAllMail then hooksecurefunc(OpenAllMail,i4xjgpXiv[75],function(zHe)zHe.timeUntilNextRetrieval=i4xjgpXiv[76]end)end