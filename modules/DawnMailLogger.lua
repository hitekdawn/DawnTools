local JuD={[1]="\65\99\101\65\100\100\111\110\45\51\46\48",[2]="\68\97\119\110\84\111\111\108\115",[3]="\68\97\119\110\77\97\105\108\76\111\103\103\101\114",[4]="\65\99\101\69\118\101\110\116\45\51\46\48",[5]="\65\99\101\84\105\109\101\114\45\51\46\48",[6]=30,[7]=1000,[8]=10,[9]=1,[10]=true,[11]=0,[12]=65521,[13]=65536,[14]="\37\48\56\120",[15]="\68\97\119\110\84\111\111\108\115",[16]="",[17]=false,[18]="\58",[19]="\109\105\115\115\105\110\103",[20]="\118\97\108\105\100",[21]="\116\97\109\112\101\114\101\100",[22]="\77\65\73\76\95\83\85\67\67\69\83\83",[23]="\79\110\69\118\101\110\116",[24]="\80\76\65\89\69\82\95\77\79\78\69\89",[25]="\79\110\69\118\101\110\116",[26]="\77\65\73\76\95\70\65\73\76\69\68",[27]="\79\110\69\118\101\110\116",[28]="\77\97\105\108\32\76\111\103\103\101\114\124\114\58\32\124\99\70\70\70\70\48\48\48\48\73\110\118\97\108\105\100\32\109\97\105\108\32\100\97\116\97\44\32\110\111\116\32\108\111\103\103\105\110\103\124\114",[29]="\77\97\105\108\32\76\111\103\103\101\114\124\114\58\32\124\99\70\70\70\70\65\65\48\48",[30]="\124\114",[31]="\81\117\101\117\101\32\111\118\101\114\102\108\111\119\32\40\62",[32]="\32\101\110\116\114\105\101\115\41\44\32\102\111\114\99\105\110\103\32\99\108\101\97\110\117\112",[33]="\81\117\101\117\101\32\115\116\105\108\108\32\102\117\108\108\32\97\102\116\101\114\32\99\111\109\112\97\99\116\105\111\110\44\32\100\114\111\112\112\105\110\103\32\111\108\100\101\115\116\32\101\110\116\114\121",[34]="\79\110\84\105\109\101\111\117\116",[35]=nil,[36]=100000,[37]="\115\101\110\100",[38]="\114\101\99\101\105\118\101",[39]="\77\97\105\108\32\102\97\105\108\101\100\58\32\37\115\32\45\62\32\37\115\32\40\37\46\48\102\103\41",[40]="\85\78\75\78\79\87\78",[41]="\85\78\75\78\79\87\78",[42]="\84\105\109\101\111\117\116\58\32\78\111\32\101\118\101\110\116\32\102\111\114\32\37\115\32\109\97\105\108\32\37\115\32\45\62\32\37\115\32\40\37\46\48\102\103\41\32\97\102\116\101\114\32\37\100\115",[43]="\85\78\75\78\79\87\78",[44]="\85\78\75\78\79\87\78",[45]="\77\65\73\76\95\83\85\67\67\69\83\83",[46]="\80\76\65\89\69\82\95\77\79\78\69\89",[47]="\77\65\73\76\95\70\65\73\76\69\68",[48]="\83\101\110\100\77\97\105\108",[49]="\112\108\97\121\101\114",[50]="\45",[51]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[52]="\115\101\110\100",[53]="\84\97\107\101\73\110\98\111\120\77\111\110\101\121",[54]=3,[55]="\45",[56]="\112\108\97\121\101\114",[57]="\45",[58]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[59]=31,[60]=24,[61]=60,[62]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[63]="\112\108\97\121\101\114",[64]="\45",[65]="\114\101\99\101\105\118\101",[66]="\65\117\116\111\76\111\111\116\77\97\105\108\73\116\101\109",[67]="\45",[68]="\112\108\97\121\101\114",[69]="\45",[70]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[71]="\33\37\89\45\37\109\45\37\100\32\37\88\32\40\37\65\41",[72]="\112\108\97\121\101\114",[73]="\45",[74]="\114\101\99\101\105\118\101",[75]="\80\114\111\99\101\115\115\78\101\120\116\73\116\101\109",[76]=0.3,[77]="\88\70\85\53\75\52\55\48\82\32\49\53\32\52\87\51\53\48\77\51\46\32\75\82\51\68\49\55\32\55\48\32\88\70\85\53\75\52\55\48\82\33"}local StSUwPU5=LibStub(JuD[1]):GetAddon(JuD[2])local Sp1u2V9MKvy=StSUwPU5:NewModule(JuD[3],JuD[4],JuD[5])local NarbUgIF=JuD[6]local tJ6zNXUhBTE=JuD[7]local j3=JuD[8]Sp1u2V9MKvy.pendingQueue={}Sp1u2V9MKvy.queueHead=JuD[9]Sp1u2V9MKvy.timeoutTimers={}Sp1u2V9MKvy.enabled=JuD[10]Sp1u2V9MKvy.eventCount=JuD[11]Sp1u2V9MKvy.lastKnownMoney=JuD[11]function Sp1u2V9MKvy:Adler32(Srpes)local uF9ws6vfF=JuD[9]local s4ENUmD9cjXwphEkwL=JuD[11]local UpKL6PW=JuD[12]for i=JuD[9],#Srpes do uF9ws6vfF=(uF9ws6vfF+string.byte(Srpes,i))%UpKL6PW;s4ENUmD9cjXwphEkwL=(s4ENUmD9cjXwphEkwL+uF9ws6vfF)%UpKL6PW end;local e7fmpxHDWWBPUbqA=(s4ENUmD9cjXwphEkwL*JuD[13])+uF9ws6vfF;return string.format(JuD[14],e7fmpxHDWWBPUbqA)end;function Sp1u2V9MKvy:GenerateMailChecksum(DTAXxMSjVgsSNJ2m84)local VZnA={JuD[15],DTAXxMSjVgsSNJ2m84.source or JuD[16],DTAXxMSjVgsSNJ2m84.destination or JuD[16],tostring(DTAXxMSjVgsSNJ2m84.gold or JuD[16]),DTAXxMSjVgsSNJ2m84.subject or JuD[16],DTAXxMSjVgsSNJ2m84.body or JuD[16],tostring(DTAXxMSjVgsSNJ2m84.sent or JuD[16]),DTAXxMSjVgsSNJ2m84.date or JuD[16]}if DTAXxMSjVgsSNJ2m84.sent==JuD[17]and DTAXxMSjVgsSNJ2m84.dateOpened then table.insert(VZnA,DTAXxMSjVgsSNJ2m84.dateOpened)end;local j63jen_4NTMH4bTkouwzx=table.concat(VZnA,JuD[18])return self:Adler32(j63jen_4NTMH4bTkouwzx)end;function Sp1u2V9MKvy:ValidateMailChecksum(KuDu1lRH)if not KuDu1lRH.id then return JuD[19]end;local AtG=self:GenerateMailChecksum(KuDu1lRH)if KuDu1lRH.id==AtG then return JuD[20]else return JuD[21]end end;function Sp1u2V9MKvy:OnEnable()self.db=StSUwPU5.db.global.maillog;self:RegisterEvent(JuD[22],JuD[23])self:RegisterEvent(JuD[24],JuD[25])self:RegisterEvent(JuD[26],JuD[27])self.lastKnownMoney=GetMoney()end;function Sp1u2V9MKvy:LogMailEntry(ZEANoUHSCSb5Pfjgra)if not ZEANoUHSCSb5Pfjgra.source or not ZEANoUHSCSb5Pfjgra.destination or not ZEANoUHSCSb5Pfjgra.gold then StSUwPU5:Print(StSUwPU5.ColorString..JuD[28])return JuD[17]end;ZEANoUHSCSb5Pfjgra.id=self:GenerateMailChecksum(ZEANoUHSCSb5Pfjgra)self.db[#self.db+JuD[9]]=ZEANoUHSCSb5Pfjgra;return JuD[10]end;function Sp1u2V9MKvy:LogWarning(zcEpU_Es)StSUwPU5:Print(StSUwPU5.ColorString..JuD[29]..zcEpU_Es..JuD[30])end;function Sp1u2V9MKvy:EnqueueMail(GW81LVLg82,UxqDj)if#self.pendingQueue>=tJ6zNXUhBTE then self:LogWarning(JuD[31]..tJ6zNXUhBTE..JuD[32])self:CompactQueue()if#self.pendingQueue>=tJ6zNXUhBTE then self:LogWarning(JuD[33])table.remove(self.pendingQueue,self.queueHead)end end;local xozeM=#self.pendingQueue+JuD[9]local aP5R={mailData=GW81LVLg82,timestamp=GetServerTime(),type=UxqDj,queueIndex=xozeM,goldBeforeSend=GetMoney()}self.pendingQueue[xozeM]=aP5R;self.timeoutTimers[xozeM]=self:ScheduleTimer(JuD[34],NarbUgIF,xozeM)return xozeM end;function Sp1u2V9MKvy:ProcessQueueHead()if self.queueHead>#self.pendingQueue then return JuD[17]end;local r_lS=self.pendingQueue[self.queueHead]self:LogMailEntry(r_lS.mailData)if self.timeoutTimers[r_lS.queueIndex]then self:CancelTimer(self.timeoutTimers[r_lS.queueIndex])self.timeoutTimers[r_lS.queueIndex]=JuD[35]end;self.queueHead=self.queueHead+JuD[9]self.eventCount=self.eventCount+JuD[9]if self.eventCount>=j3 then self:CompactQueue()self.eventCount=JuD[11]end;return JuD[10]end;function Sp1u2V9MKvy:OnMailSuccess()if self:ProcessQueueHead()then self.lastKnownMoney=GetMoney()end end;function Sp1u2V9MKvy:OnPlayerMoney()if self.queueHead>#self.pendingQueue then self.lastKnownMoney=GetMoney()return end;local rd3p=GetMoney()local gDkgIwc0G=self.lastKnownMoney-rd3p;local dn1V4qav8Km15p_tRi1Kr=self.pendingQueue[self.queueHead]local UryM=JuD[36]local r_cr=dn1V4qav8Km15p_tRi1Kr.mailData.gold;if dn1V4qav8Km15p_tRi1Kr.type==JuD[37]then r_cr=dn1V4qav8Km15p_tRi1Kr.mailData.gold elseif dn1V4qav8Km15p_tRi1Kr.type==JuD[38]then r_cr=-dn1V4qav8Km15p_tRi1Kr.mailData.gold end;if math.abs(gDkgIwc0G-r_cr)<=UryM then if self:ProcessQueueHead()then self.lastKnownMoney=rd3p end else self.lastKnownMoney=rd3p end end;function Sp1u2V9MKvy:OnMailFailed()if self.queueHead>#self.pendingQueue then return end;local _W6tS5J6=self.pendingQueue[self.queueHead]local Yd1g3coIz3O71o=_W6tS5J6.mailData.gold/COPPER_PER_GOLD;self:LogWarning(string.format(JuD[39],_W6tS5J6.mailData.source or JuD[40],_W6tS5J6.mailData.destination or JuD[41],Yd1g3coIz3O71o))if self.timeoutTimers[_W6tS5J6.queueIndex]then self:CancelTimer(self.timeoutTimers[_W6tS5J6.queueIndex])self.timeoutTimers[_W6tS5J6.queueIndex]=JuD[35]end;self.queueHead=self.queueHead+JuD[9]self.eventCount=self.eventCount+JuD[9]if self.eventCount>=j3 then self:CompactQueue()self.eventCount=JuD[11]end end;function Sp1u2V9MKvy:OnTimeout(tPf7kI6Nuu)self.timeoutTimers[tPf7kI6Nuu]=JuD[35]if tPf7kI6Nuu<self.queueHead then return end;if tPf7kI6Nuu==self.queueHead then local OmovSAtK=self.pendingQueue[tPf7kI6Nuu]if OmovSAtK then local g9=GetMoney()local EgNE1U2Qy3=OmovSAtK.goldBeforeSend-OmovSAtK.mailData.gold-JuD[6]local bpnEQQs8cyti_=JuD[36]if math.abs(g9 -EgNE1U2Qy3)<=bpnEQQs8cyti_ then self:LogMailEntry(OmovSAtK.mailData)if self.timeoutTimers[OmovSAtK.queueIndex]then self:CancelTimer(self.timeoutTimers[OmovSAtK.queueIndex])self.timeoutTimers[OmovSAtK.queueIndex]=JuD[35]end else local cBGT9onSU=OmovSAtK.mailData.gold/COPPER_PER_GOLD;self:LogWarning(string.format(JuD[42],OmovSAtK.type,OmovSAtK.mailData.source or JuD[43],OmovSAtK.mailData.destination or JuD[44],cBGT9onSU,NarbUgIF))end end;self.queueHead=self.queueHead+JuD[9]self:CompactQueue()else end end;function Sp1u2V9MKvy:CompactQueue()if self.queueHead<=JuD[9]then return end;local STSdN9nnMABQ={}for i=self.queueHead,#self.pendingQueue do table.insert(STSdN9nnMABQ,self.pendingQueue[i])end;self.pendingQueue=STSdN9nnMABQ;self.queueHead=JuD[9]end;function Sp1u2V9MKvy:OnEvent(eaR2zEliSh5Ryq1,...)if eaR2zEliSh5Ryq1 ==JuD[45]then self:OnMailSuccess()elseif eaR2zEliSh5Ryq1 ==JuD[46]then self:OnPlayerMoney()elseif eaR2zEliSh5Ryq1 ==JuD[47]then self:OnMailFailed()end end;hooksecurefunc(JuD[48],function(tz6txgH6,M1WOMWz7TupYr0K7eaOU,eKyXK1YQOLCsGX)if not Sp1u2V9MKvy.enabled then return end;local UjD=GetSendMailMoney()if UjD<=JuD[11]then return end;local PIb05o72RMbAgGG_BWlg,EihRYTY6=UnitFullName(JuD[49])local zoPfqTdlnNZdHLFtSNR0y={source=PIb05o72RMbAgGG_BWlg..JuD[50]..EihRYTY6,destination=tz6txgH6,gold=UjD,subject=M1WOMWz7TupYr0K7eaOU,body=eKyXK1YQOLCsGX,sent=JuD[10],date=date(JuD[51],GetServerTime())}Sp1u2V9MKvy:EnqueueMail(zoPfqTdlnNZdHLFtSNR0y,JuD[52])end)hooksecurefunc(JuD[53],function(OkUAxh7LVBl8S)if not Sp1u2V9MKvy.enabled then return end;local nHH8y,dFjV3zKQOWZzv54,iR,qIKvU,I4zGROYwb6iM4TJU9fs=select(JuD[54],GetInboxHeaderInfo(OkUAxh7LVBl8S))if iR<=JuD[11]then return end;local lAMYgHfYH_ymKQQNnAYZP=GetInboxText(OkUAxh7LVBl8S)if nHH8y and not nHH8y:find(JuD[55])then local ZnDjdh2st,Pp1CQBIU4a75e_UAk=UnitFullName(JuD[56])nHH8y=nHH8y..JuD[57]..Pp1CQBIU4a75e_UAk end;local UxNuo=date(JuD[58],GetServerTime()- (JuD[59]-I4zGROYwb6iM4TJU9fs)*JuD[60]*JuD[61]*JuD[61])local EYsv8jaMdpzJewMdI=date(JuD[62],GetServerTime())local EdftBmUTS0D8WvCEjrj,KXecc_fh2nC=UnitFullName(JuD[63])local VAjMXUtt={source=nHH8y,destination=EdftBmUTS0D8WvCEjrj..JuD[64]..KXecc_fh2nC,gold=iR,subject=dFjV3zKQOWZzv54,body=lAMYgHfYH_ymKQQNnAYZP,sent=JuD[17],date=UxNuo,dateOpened=EYsv8jaMdpzJewMdI}Sp1u2V9MKvy:EnqueueMail(VAjMXUtt,JuD[65])end)hooksecurefunc(JuD[66],function(TARUBFMR1f_Bgw6wlzei)if not Sp1u2V9MKvy.enabled then return end;local uIpi_X24NSlmE,JtWP1ReYw4sEwnQYq8Mp,dSANU_finWcdeK,VfRa4M,dfwj1u7e8j7WQpqg9e=select(JuD[54],GetInboxHeaderInfo(TARUBFMR1f_Bgw6wlzei))if dSANU_finWcdeK<=JuD[11]then return end;local lz=GetInboxText(TARUBFMR1f_Bgw6wlzei)if uIpi_X24NSlmE and not uIpi_X24NSlmE:find(JuD[67])then local Vv4TCUgoiOMfIOLd6MdL,EDUkAxLczZ_CI=UnitFullName(JuD[68])uIpi_X24NSlmE=uIpi_X24NSlmE..JuD[69]..EDUkAxLczZ_CI end;local qhh=date(JuD[70],GetServerTime()- (JuD[59]-dfwj1u7e8j7WQpqg9e)*JuD[60]*JuD[61]*JuD[61])local XldYeOqWURpliTV7=date(JuD[71],GetServerTime())local xc2xqqk3Di,gFpR9P2jtjVPE=UnitFullName(JuD[72])local dd1FLorjKQTBcWrMVDQa={source=uIpi_X24NSlmE,destination=xc2xqqk3Di..JuD[73]..gFpR9P2jtjVPE,gold=dSANU_finWcdeK,subject=JtWP1ReYw4sEwnQYq8Mp,body=lz,sent=JuD[17],date=qhh,dateOpened=XldYeOqWURpliTV7}Sp1u2V9MKvy:EnqueueMail(dd1FLorjKQTBcWrMVDQa,JuD[74])end)if OpenAllMail then hooksecurefunc(OpenAllMail,JuD[75],function(QwTGVB8wHi_XmNW1eKfU0)QwTGVB8wHi_XmNW1eKfU0.timeUntilNextRetrieval=JuD[76]end)end